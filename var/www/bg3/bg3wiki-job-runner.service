[Unit]

Description = BG3 Wiki Job Runner

After = mariadb.service
After = php8.4-fpm.service
After = nginx.service
After = elasticsearch.service

StartLimitBurst = 20
StartLimitIntervalSec = 1s

[Service]

User = www-data
ProtectSystem = full
WorkingDirectory = /var/www/bg3/w

Restart = always
RestartSec = 20ms

ExecStart = php maintenance/run.php runJobs \
	--wait --maxjobs 300 --maxtime 900 \
	--memory-limit 512M --quiet

Nice = 19
IOSchedulingClass = idle

MemoryMax = 2G
MemoryHigh = 1G

OOMScoreAdjust = 800

StandardOutput = append:/var/log/bg3wiki-job-runner.log
StandardError = append:/var/log/bg3wiki-job-runner.log

[Install]

WantedBy = multi-user.target
